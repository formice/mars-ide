
const WARN = 'warning';
const ERROR = 'error';
const OK = "ok";
// -------------------服务端获取数据 ------------------------------
/*let {data,name} = (function(){
	let data = [];
	let name = '欢迎登陆Swallow';
	let token = window.localStorage.getItem('tokenpanyanzi');
	if (token) {
		$.ajaxSetup({
		headers: {
		  'x-access-token': token
		}
	  });
	} else {
		location.href = '/login';
		return;
	}
	$.ajax({
		url: '/api/get_user_file',
		method: 'post',
		async: false,
		success: (d) => {
			if(d.status === 0) {
				$('.onloading').hide();
				data = d.data || [];
				name = d.name || '欢迎登陆Swallow';
			} else {
				location.href = '/login';
			}
		},
		error: (err) => {
			location.href = '/login';
		}
	});
	return {data,name};
})();*/

// -------------------操作数据相关 ------------------------------
class Data {
	constructor(data) {
		this.data = data;
		this.name = name;
		this.initTree = -1;
		this.initPath = this.getChildsById(this.initTree)[0] ? this.getChildsById(this.initTree)[0].id : -1;
	}
	getItemById(id) {
		let tar = null
		this.data.forEach((item) => {
			if (item.id === parseInt(id)) {
				tar = item;
			}
		});
		return tar;
	}
	getChildsById(id) {
		return  this.data.filter((item) => {
			return item.pid === parseInt(id)
		}); 
	}
	getParentAllById(id) {
		let arr = [];
		let item = this.getItemById(id); // 先找到这条数据
		if(item){
			arr.push(item);
			arr = arr.concat(this.getParentAllById(item.pid))
		}
		return arr; 
	}
	// 通过一个id，找到所有的子孙数据 不包含自己
	getChildsAllById(id) {
		let self = this.getItemById(id);
		let arr = [];
		arr.push(self);
		let childs =  this.getChildsById(id);
		childs.forEach((item) => {
			arr = arr.concat(this.getChildsAllById(item.id));
		})
		return arr;
	}
	// 接收一个数组，找数组id的每一个子孙
	getChildsAllByIds(idsArr) {
		let arr = [];
		idsArr.forEach((item) => {
			arr = arr.concat(this.getChildsAllById(item));
		})
		return arr; 
	}
	delectItemById(id){
		this.data = this.data.filter((item) => {
			return item.id !== parseInt(id);
		});
	}
	// 批量删除，传入一个数组 [1,2,3,4]
	delectItemByIds(delectIds){
		delectIds.forEach((item) => {
			this.delectItemById(item);
		});
	}
	getBrothersById(id) {
		let self = this.getItemById(id); // 自己
		return this.data.filter((item) => {
			return item.pid === self.pid
		})
	}
	isExistBrothersNameById(id,last_name) { 
		let brothers = this.getBrothersById(id).filter((item) => {
			return item.id != id;   
		});
		return brothers.some((item) => {
			return item.last_name == last_name;
		});
	}
	setDataAttr(id,attr,val) {
		this.data.map((item) => {
			if (item.id === parseInt(id)) {
				item[attr] = val;
			}
			return item;
		});
	}
	// 指定一个id，找到这个id中所有的子级中是否包含传入的value,true false
	isExistChildsNameById(id,value) {
		let childs = this.getChildsById(id);
		return childs.some((item) => {
			return item.last_name == value;
		});
	}
	addDate(o) {
		this.data.unshift(o);
	}
	getParentById(id) {
		let self = this.getItemById(id);
		return this.data.filter((item) => {
			return item.id === self.pid;
		});
	}
}
//let dataOpera = new Data(data,name);
let dataOpera = new Data([
        {
            "hash_name":"1532783761628-云盘",
            "last_name":"云盘",
            "type":"dir",
            "id":8,
            "pid":-1,
            "size":null
        },
        {
            "hash_name":"1532784193132-logo.jpeg",
            "last_name":"logo.jpeg",
            "type":"image/jpeg",
            "id":12,
            "pid":11,
            "size":null
        },
        {
            "hash_name":"1536556953664-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":23,
            "pid":13,
            "size":null
        },
        {
            "hash_name":"1538984929666-encode.py",
            "last_name":"encode.py",
            "type":"text/x-python",
            "id":28,
            "pid":11,
            "size":null
        },
        {
            "hash_name":"1538985002028-给学生的资源.zip",
            "last_name":"给学生的资源.zip",
            "type":"application/zip",
            "id":30,
            "pid":26,
            "size":null
        },
        {
            "hash_name":"1538989582652-534543",
            "last_name":"534543",
            "type":"dir",
            "id":31,
            "pid":24,
            "size":null
        },
        {
            "hash_name":"1538990901033-新建文件夹题4他",
            "last_name":"新建文件夹题4他",
            "type":"dir",
            "id":32,
            "pid":19,
            "size":null
        },
        {
            "hash_name":"1538990910127-新建文件夹35345",
            "last_name":"新建文件夹35345",
            "type":"dir",
            "id":33,
            "pid":32,
            "size":null
        },
        {
            "hash_name":"1549979581292-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":40,
            "pid":38,
            "size":null
        },
        {
            "hash_name":"1549979585256-新建文件夹(1)",
            "last_name":"新建文件夹(1)",
            "type":"dir",
            "id":41,
            "pid":38,
            "size":null
        },
        {
            "hash_name":"1551405008952-u1657.png",
            "last_name":"u1657.png",
            "type":"image/png",
            "id":47,
            "pid":45,
            "size":null
        },
        {
            "hash_name":"1552738840423-78",
            "last_name":"78",
            "type":"dir",
            "id":52,
            "pid":45,
            "size":null
        },
        {
            "hash_name":"1553153114716-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":75,
            "pid":73,
            "size":null
        },
        {
            "hash_name":"1553153119141-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":76,
            "pid":75,
            "size":null
        },
        {
            "hash_name":"1556368275083-hell",
            "last_name":"hell",
            "type":"dir",
            "id":80,
            "pid":87,
            "size":null
        },
        {
            "hash_name":"1557816590778-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":86,
            "pid":85,
            "size":null
        },
        {
            "hash_name":"1557830173392-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":90,
            "pid":86,
            "size":null
        },
        {
            "hash_name":"1557830174934-新建文件夹(1)",
            "last_name":"新建文件夹(1)",
            "type":"dir",
            "id":91,
            "pid":86,
            "size":null
        },
        {
            "hash_name":"1557830178073-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":92,
            "pid":91,
            "size":null
        },
        {
            "hash_name":"1557830180644-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":93,
            "pid":92,
            "size":null
        },
        {
            "hash_name":"1557830182901-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":94,
            "pid":93,
            "size":null
        },
        {
            "hash_name":"1557830184474-新建文件夹(1)",
            "last_name":"新建文件夹(1)",
            "type":"dir",
            "id":95,
            "pid":93,
            "size":null
        },
        {
            "hash_name":"1557830188164-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":96,
            "pid":95,
            "size":null
        },
        {
            "hash_name":"1557830190203-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":97,
            "pid":96,
            "size":null
        },
        {
            "hash_name":"1557830192442-张三",
            "last_name":"张三",
            "type":"dir",
            "id":98,
            "pid":97,
            "size":null
        },
        {
            "hash_name":"1557830194783-新建文件夹(2)",
            "last_name":"新建文件夹(2)",
            "type":"dir",
            "id":99,
            "pid":93,
            "size":null
        },
        {
            "hash_name":"1557830197862-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":100,
            "pid":98,
            "size":null
        },
        {
            "hash_name":"1557830204925-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":101,
            "pid":100,
            "size":null
        },
        {
            "hash_name":"1557830209050-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":102,
            "pid":101,
            "size":null
        },
        {
            "hash_name":"1558165817722-baoge.png",
            "last_name":"baoge.png",
            "type":"image/png",
            "id":108,
            "pid":105,
            "size":null
        },
        {
            "hash_name":"1558189294540-boss.png",
            "last_name":"boss.png",
            "type":"image/png",
            "id":109,
            "pid":80,
            "size":null
        },
        {
            "hash_name":"1558324541545-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":117,
            "pid":87,
            "size":null
        },
        {
            "hash_name":"1558324561922-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":118,
            "pid":116,
            "size":null
        },
        {
            "hash_name":"1558687727275-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":119,
            "pid":80,
            "size":null
        },
        {
            "hash_name":"1560501005844-6.jpg",
            "last_name":"6.jpg",
            "type":"image/jpeg",
            "id":120,
            "pid":121,
            "size":null
        },
        {
            "hash_name":"1561968982134-新建文件夹",
            "last_name":"1",
            "type":"dir",
            "id":131,
            "pid":134,
            "size":null
        },
        {
            "hash_name":"1561969531711-share_title.png",
            "last_name":"share_title.png",
            "type":"image/png",
            "id":132,
            "pid":131,
            "size":null
        },
        {
            "hash_name":"1562875670534-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":133,
            "pid":127,
            "size":null
        },
        {
            "hash_name":"1564020663093-新建文件夹(1)",
            "last_name":"新建文件夹(1)",
            "type":"dir",
            "id":134,
            "pid":123,
            "size":null
        },
        {
            "hash_name":"1564192355000-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":135,
            "pid":128,
            "size":null
        },
        {
            "hash_name":"1570382248651-的无侦-8型无人侦察机.jpg",
            "last_name":"无侦-8型无人侦察机.jpg",
            "type":"image/jpeg",
            "id":141,
            "pid":123,
            "size":null
        },
        {
            "hash_name":"1572963216677-lel",
            "last_name":"lel",
            "type":"dir",
            "id":145,
            "pid":144,
            "size":null
        },
        {
            "hash_name":"1574662355388-foo.txt",
            "last_name":"lei",
            "type":"text/plain",
            "id":146,
            "pid":144,
            "size":null
        },
        {
            "hash_name":"1576162688845-1.jpg",
            "last_name":"1.jpg",
            "type":"image/jpeg",
            "id":149,
            "pid":144,
            "size":null
        },
        {
            "hash_name":"1576302781157-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":151,
            "pid":150,
            "size":null
        },
        {
            "hash_name":"1584380092684-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":162,
            "pid":145,
            "size":null
        },
        {
            "hash_name":"1584380097565-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":164,
            "pid":163,
            "size":null
        },
        {
            "hash_name":"1584385145908-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":166,
            "pid":151,
            "size":null
        },
        {
            "hash_name":"1584492967842-新建文件夹(2)",
            "last_name":"新建文件夹(2)",
            "type":"dir",
            "id":180,
            "pid":179,
            "size":null
        },
        {
            "hash_name":"1584492968308-新建文件夹(3)",
            "last_name":"新建文件夹(3)",
            "type":"dir",
            "id":181,
            "pid":179,
            "size":null
        },
        {
            "hash_name":"1584493116737-新建文件夹(4)",
            "last_name":"新建文件夹(4)",
            "type":"dir",
            "id":187,
            "pid":179,
            "size":null
        },
        {
            "hash_name":"1584493117025-新建文件夹(5)",
            "last_name":"新建文件夹(5)",
            "type":"dir",
            "id":188,
            "pid":179,
            "size":null
        },
        {
            "hash_name":"1584493118587-新建文件夹(6)",
            "last_name":"新建文件夹(6)",
            "type":"dir",
            "id":189,
            "pid":179,
            "size":null
        },
        {
            "hash_name":"1584493120458-新建文件夹(7)",
            "last_name":"新建文件夹(7)",
            "type":"dir",
            "id":190,
            "pid":179,
            "size":null
        },
        {
            "hash_name":"1584493123473-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":191,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493123818-新建文件夹(1)",
            "last_name":"新建文件夹(1)",
            "type":"dir",
            "id":192,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493124102-新建文件夹(2)",
            "last_name":"新建文件夹(2)",
            "type":"dir",
            "id":193,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493124343-新建文件夹(3)",
            "last_name":"新建文件夹(3)",
            "type":"dir",
            "id":194,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493124616-新建文件夹(4)",
            "last_name":"新建文件夹(4)",
            "type":"dir",
            "id":195,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493124888-新建文件夹(5)",
            "last_name":"新建文件夹(5)",
            "type":"dir",
            "id":196,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493125291-新建文件夹(6)",
            "last_name":"新建文件夹(6)",
            "type":"dir",
            "id":197,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493125608-新建文件夹(7)",
            "last_name":"新建文件夹(7)",
            "type":"dir",
            "id":198,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493125909-新建文件夹(8)",
            "last_name":"新建文件夹(8)",
            "type":"dir",
            "id":199,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493126165-新建文件夹(9)",
            "last_name":"新建文件夹(9)",
            "type":"dir",
            "id":200,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493126481-新建文件夹(10)",
            "last_name":"新建文件夹(10)",
            "type":"dir",
            "id":201,
            "pid":182,
            "size":null
        },
        {
            "hash_name":"1584493131265-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":202,
            "pid":196,
            "size":null
        },
        {
            "hash_name":"1584493131536-新建文件夹(1)",
            "last_name":"新建文件夹(1)",
            "type":"dir",
            "id":203,
            "pid":196,
            "size":null
        },
        {
            "hash_name":"1584493131761-新建文件夹(2)",
            "last_name":"新建文件夹(2)",
            "type":"dir",
            "id":204,
            "pid":196,
            "size":null
        },
        {
            "hash_name":"1584493132003-新建文件夹(3)",
            "last_name":"新建文件夹(3)",
            "type":"dir",
            "id":205,
            "pid":196,
            "size":null
        },
        {
            "hash_name":"1584493132255-新建文件夹(4)",
            "last_name":"新建文件夹(4)",
            "type":"dir",
            "id":206,
            "pid":196,
            "size":null
        },
        {
            "hash_name":"1584493134421-新建文件夹(5)",
            "last_name":"新建文件夹(5)",
            "type":"dir",
            "id":207,
            "pid":196,
            "size":null
        },
        {
            "hash_name":"1585092753543-lifecycle.png",
            "last_name":"lifecycle.png",
            "type":"image/png",
            "id":209,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1585122195012-300.jpeg",
            "last_name":"300.jpeg",
            "type":"image/jpeg",
            "id":210,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1585810592079-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":211,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134106430-新建文件夹(1)",
            "last_name":"新建文件夹(1)",
            "type":"dir",
            "id":212,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134107081-新建文件夹(2)",
            "last_name":"新建文件夹(2)",
            "type":"dir",
            "id":213,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134107257-新建文件夹(3)",
            "last_name":"新建文件夹(3)",
            "type":"dir",
            "id":214,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134107425-新建文件夹(4)",
            "last_name":"新建文件夹(4)",
            "type":"dir",
            "id":215,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134107577-新建文件夹(5)",
            "last_name":"新建文件夹(5)",
            "type":"dir",
            "id":216,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134107729-新建文件夹(6)",
            "last_name":"新建文件夹(6)",
            "type":"dir",
            "id":217,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134107880-新建文件夹(7)",
            "last_name":"新建文件夹(7)",
            "type":"dir",
            "id":218,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134108042-新建文件夹(8)",
            "last_name":"新建文件夹(8)",
            "type":"dir",
            "id":219,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134108192-新建文件夹(9)",
            "last_name":"新建文件夹(9)",
            "type":"dir",
            "id":220,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134108337-新建文件夹(10)",
            "last_name":"新建文件夹(10)",
            "type":"dir",
            "id":221,
            "pid":208,
            "size":null
        },
        {
            "hash_name":"1587134120382-timg.jpg",
            "last_name":"timg.jpg",
            "type":"image/jpeg",
            "id":222,
            "pid":221,
            "size":null
        },
        {
            "hash_name":"1587260707709-新建文本文档.txt",
            "last_name":"新建文本文档.txt",
            "type":"text/plain",
            "id":223,
            "pid":230,
            "size":null
        },
        {
            "hash_name":"1587273619512-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":224,
            "pid":8,
            "size":null
        },
        {
            "hash_name":"1587273623440-5501600-0f82681c0c3158de.png",
            "last_name":"5501600-0f82681c0c3158de.png",
            "type":"image/png",
            "id":225,
            "pid":8,
            "size":null
        },
        {
            "hash_name":"1587274866066-新建文件夹",
            "last_name":"新建文件夹",
            "type":"dir",
            "id":226,
            "pid":224,
            "size":null
        },
        {
            "hash_name":"1587274868777-5501600-0f82681c0c3158de.png",
            "last_name":"5501600-0f82681c0c3158de.png",
            "type":"image/png",
            "id":227,
            "pid":224,
            "size":null
        },
        {
            "hash_name":"1587274879824-5501600-0f82681c0c3158de.webp",
            "last_name":"5501600-0f82681c0c3158de.webp",
            "type":"image/webp",
            "id":228,
            "pid":8,
            "size":null
        },
        {
            "hash_name":"1587274881963-新建文件夹(1)",
            "last_name":"新建文件夹(1)",
            "type":"dir",
            "id":229,
            "pid":8,
            "size":null
        },
        {
            "hash_name":"1588058940729-22222",
            "last_name":"22222",
            "type":"dir",
            "id":230,
            "pid":224,
            "size":null
        },
        {
            "hash_name":"1588058948280-u=2586971025,664981087&fm=26&gp=0.jpg",
            "last_name":"u=2586971025,664981087&fm=26&gp=0.jpg",
            "type":"image/jpeg",
            "id":231,
            "pid":224,
            "size":null
        },
        {
            "hash_name":"1588085407386-新建文件夹(2)",
            "last_name":"新建文件夹(2)",
            "type":"dir",
            "id":232,
            "pid":8,
            "size":null
        },
        {
            "hash_name":"1588916205985-12",
            "last_name":"12222",
            "type":"dir",
            "id":234,
            "pid":8,
            "size":null
        },
        {
            "hash_name":"1588916261320-1.jpg",
            "last_name":"1.jpg",
            "type":"image/jpeg",
            "id":236,
            "pid":224,
            "size":null
        },
        {
            "hash_name":"1591080353448-2020-activity-share.png",
            "last_name":"2020-activity-share.png",
            "type":"image/png",
            "id":237,
            "pid":224,
            "size":null
        },
        {
            "hash_name":"1591080558096-ioio",
            "last_name":"ioio",
            "type":"dir",
            "id":238,
            "pid":8,
            "size":null
        },
        {
            "hash_name":"1592305773773-新建文件夹(1)",
            "last_name":"新建文件夹(1)",
            "type":"dir",
            "id":240,
            "pid":224,
            "size":null
        },
        {
            "hash_name":"1592305779790-fff123",
            "last_name":"fff123",
            "type":"dir",
            "id":241,
            "pid":224,
            "size":null
        },
        {
            "hash_name":"1592305788282-root",
            "last_name":"root",
            "type":"dir",
            "id":242,
            "pid":8,
            "size":null
        }
    ],name);
